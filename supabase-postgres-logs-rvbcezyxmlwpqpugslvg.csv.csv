detail,error_severity,event_message,hint,id,identifier,timestamp
null,LOG,connection authorized: user=supabase_admin database=postgres application_name=postgres_exporter,null,f1afbd25-3e5a-4301-84cc-0674861202f7,rvbcezyxmlwpqpugslvg,1748513548904000
null,LOG,connection received: host=::1 port=61513,null,ba7105e9-8904-4082-96bd-0dd995580a3a,rvbcezyxmlwpqpugslvg,1748513548903000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,0f430c3c-9ffa-45df-b359-d31fe3733e32,rvbcezyxmlwpqpugslvg,1748513540973000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,7aac21d9-304d-46d3-af7a-2bdb275a3168,rvbcezyxmlwpqpugslvg,1748513540973000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,db0f5c98-dafc-4e59-a0cb-a7c3db3758a5,rvbcezyxmlwpqpugslvg,1748513540971000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,982e4296-06b2-4708-b073-1d083de84ac2,rvbcezyxmlwpqpugslvg,1748513540965000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,e9431433-ddf2-49e3-9b4a-e7e1dfb0143f,rvbcezyxmlwpqpugslvg,1748513540962000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,d959f03d-3592-4559-86a3-2dce36662c9a,rvbcezyxmlwpqpugslvg,1748513540954000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,08e4d490-9e12-4870-965c-a1b14a604748,rvbcezyxmlwpqpugslvg,1748513540914000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,387f2fbe-cd43-4924-a06b-aaa153511b74,rvbcezyxmlwpqpugslvg,1748513540865000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,a3b91d4a-8da0-4585-8d2c-877343c1504a,rvbcezyxmlwpqpugslvg,1748513540770000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,019c653d-4a63-4939-9ac7-60a0f7f5d368,rvbcezyxmlwpqpugslvg,1748513540679000
null,LOG,connection received: host=::1 port=6761,null,ddf91a9e-1f6a-4aa9-a4c0-dd7e2c463549,rvbcezyxmlwpqpugslvg,1748513540671000
null,LOG,connection authorized: user=supabase_admin database=postgres application_name=postgres_exporter,null,a8a674f0-6479-4ad1-9f97-af4726fa42c4,rvbcezyxmlwpqpugslvg,1748513488903000
null,LOG,connection received: host=::1 port=12561,null,0cb34c7a-75d2-4274-a48a-13d2429ebafd,rvbcezyxmlwpqpugslvg,1748513488902000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,5a0de76c-17f4-45e6-afb6-2372cca1817f,rvbcezyxmlwpqpugslvg,1748513449189000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,eddf756d-f771-4f99-8b71-e28b737b0fe5,rvbcezyxmlwpqpugslvg,1748513449173000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,f448e849-c3a8-406c-9f66-7dfa0a843021,rvbcezyxmlwpqpugslvg,1748513449093000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,b0088dff-82ec-43a0-920c-ba2eb0592e9b,rvbcezyxmlwpqpugslvg,1748513449076000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,55b9294b-6638-4b6f-bf15-a00e748839d9,rvbcezyxmlwpqpugslvg,1748513449007000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,6e7b6463-5135-4339-8400-738e0932c8d3,rvbcezyxmlwpqpugslvg,1748513448942000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,b3d208d8-8105-4069-a96e-f14800459e66,rvbcezyxmlwpqpugslvg,1748513448879000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,e12bfb8b-774f-4a3b-9812-aa2e94152710,rvbcezyxmlwpqpugslvg,1748513448784000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,a47f44da-4a20-4d76-b16d-a1647c633617,rvbcezyxmlwpqpugslvg,1748513448717000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,011864a5-28f9-4786-8a7e-230309fcc83f,rvbcezyxmlwpqpugslvg,1748513448655000
null,LOG,connection received: host=::1 port=63259,null,fc08063a-e711-4268-9fb7-ce1969486fce,rvbcezyxmlwpqpugslvg,1748513448648000
null,LOG,connection authorized: user=supabase_admin database=postgres application_name=postgres_exporter,null,50de2f6d-e63d-462d-bd40-c75f5d22203e,rvbcezyxmlwpqpugslvg,1748513428916000
null,LOG,connection received: host=::1 port=19099,null,5054a415-819e-4062-b9b6-fe7f1bc28ead,rvbcezyxmlwpqpugslvg,1748513428914000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,0bd02bfd-1cde-4314-adb3-3f3528b942a2,rvbcezyxmlwpqpugslvg,1748513396621000
null,LOG,connection received: host=::1 port=49485,null,07a1a6dd-9a36-4ea5-8bde-fc3686193dec,rvbcezyxmlwpqpugslvg,1748513396612000
null,LOG,connection authorized: user=supabase_admin database=postgres application_name=postgres_exporter,null,d9ede871-68e0-4f19-b7c3-864370686530,rvbcezyxmlwpqpugslvg,1748513368904000
null,LOG,connection received: host=::1 port=5717,null,b9008f1d-746d-4443-9ab5-7eba2a7c6437,rvbcezyxmlwpqpugslvg,1748513368903000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,8490d05e-1afd-4beb-a8c3-91e9ee1e3692,rvbcezyxmlwpqpugslvg,1748513364480000
null,LOG,connection received: host=::1 port=62993,null,b274b19b-7cbc-49c6-b420-c182979b7b75,rvbcezyxmlwpqpugslvg,1748513364472000
null,LOG,connection authorized: user=supabase_admin database=postgres application_name=postgres_exporter,null,556b26c8-1c88-4c5e-81d7-863ff630133f,rvbcezyxmlwpqpugslvg,1748513308906000
null,LOG,connection received: host=::1 port=63239,null,9a996258-bb82-48b5-8580-3e0a5813d060,rvbcezyxmlwpqpugslvg,1748513308906000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,adcb5e6c-671c-4300-a93e-c958a3670a1c,rvbcezyxmlwpqpugslvg,1748513254790000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,f24053d9-15f9-4cbf-a855-6cd35ff78fa3,rvbcezyxmlwpqpugslvg,1748513254782000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,d12ae122-0d32-4a36-a3de-578f149ab2f1,rvbcezyxmlwpqpugslvg,1748513254781000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,d4772136-d75a-4fb8-983e-fb9e00a4a460,rvbcezyxmlwpqpugslvg,1748513254765000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,f00c56ca-b32b-4401-b58d-473ba3cd54fe,rvbcezyxmlwpqpugslvg,1748513254740000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,6a5f1442-3b34-4039-adef-13974eb9e145,rvbcezyxmlwpqpugslvg,1748513254735000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,9b562055-6809-4ab3-a0a0-7971b52aac90,rvbcezyxmlwpqpugslvg,1748513254697000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,7656c00b-a2f6-4cd8-9f55-197d8e8902a1,rvbcezyxmlwpqpugslvg,1748513254659000
null,LOG,connection authorized: user=supabase_admin database=postgres application_name=postgres_exporter,null,a8d936e9-7787-41d0-bff2-1c9f6d945143,rvbcezyxmlwpqpugslvg,1748513248904000
null,LOG,connection received: host=::1 port=36757,null,ab31020f-ff6e-4182-9235-8db8368ff9b8,rvbcezyxmlwpqpugslvg,1748513248903000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,22213b0b-a567-4db1-a3e1-33efef19d71e,rvbcezyxmlwpqpugslvg,1748513237929000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,4653d801-712b-41b1-9036-c57cec6eec90,rvbcezyxmlwpqpugslvg,1748513237792000
null,LOG,connection received: host=::1 port=20963,null,ac2cd085-cff0-426f-be20-964f541bf198,rvbcezyxmlwpqpugslvg,1748513237783000
null,LOG,connection authorized: user=supabase_admin database=postgres application_name=postgres_exporter,null,90afed32-83ee-4388-8c01-752c5c413f61,rvbcezyxmlwpqpugslvg,1748513188903000
null,LOG,connection received: host=::1 port=19225,null,cfbcb6f3-f14d-40bb-aeec-a7b2baed4251,rvbcezyxmlwpqpugslvg,1748513188903000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,aef7a618-efec-49b7-9812-76338993fda7,rvbcezyxmlwpqpugslvg,1748513180202000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,3a3529d7-9d0d-44c0-95d4-dc6c3b8e89e1,rvbcezyxmlwpqpugslvg,1748513180180000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,35f3a5aa-c194-40fd-bc82-07feca1bda57,rvbcezyxmlwpqpugslvg,1748513180165000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,7e505214-5591-4f47-8678-d20b55f51bba,rvbcezyxmlwpqpugslvg,1748513180132000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,6fe4a29b-f894-4cfb-9c7a-a103a2e480c2,rvbcezyxmlwpqpugslvg,1748513180126000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,b4d7c360-e3f5-4571-af62-c47695a10acd,rvbcezyxmlwpqpugslvg,1748513180106000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,f2123c7f-e74a-4c8e-a90b-ebb274f1bd38,rvbcezyxmlwpqpugslvg,1748513180072000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,05681d94-d3f4-4d8f-bba2-e96542fa8db7,rvbcezyxmlwpqpugslvg,1748513179537000
null,LOG,connection received: host=::1 port=25625,null,1cfbf411-aa6b-4941-9121-84f30d1c0996,rvbcezyxmlwpqpugslvg,1748513179529000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,d5b8b085-f91b-421e-8602-7a85dc1509c4,rvbcezyxmlwpqpugslvg,1748513166641000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,d0bf9501-fbc0-4672-b68a-53b3bb9e2b1c,rvbcezyxmlwpqpugslvg,1748513166547000
null,LOG,connection received: host=::1 port=4993,null,88558425-a6d4-4c82-974c-77f74dae81e9,rvbcezyxmlwpqpugslvg,1748513166532000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,a997c5aa-3259-42b3-aa8e-575aa20fe99a,rvbcezyxmlwpqpugslvg,1748513133215000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,99a62909-9ee4-4a92-872e-4d00db7162eb,rvbcezyxmlwpqpugslvg,1748513133127000
null,LOG,connection received: host=::1 port=54377,null,cf29ad69-9d53-4a7f-8e43-e18150626860,rvbcezyxmlwpqpugslvg,1748513133116000
null,LOG,connection authorized: user=supabase_admin database=postgres application_name=postgres_exporter,null,7716059d-8e9c-4a67-b6bc-dd360998ef0c,rvbcezyxmlwpqpugslvg,1748513128915000
null,LOG,connection received: host=::1 port=54371,null,c0ce4b51-d7eb-4803-ba9e-9fc23e8c99ea,rvbcezyxmlwpqpugslvg,1748513128915000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,6fdcbc5a-1ae1-46aa-bfd1-2f68173ff856,rvbcezyxmlwpqpugslvg,1748513120984000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,fa7a4c3b-105b-4cc8-a5ef-19c71f387882,rvbcezyxmlwpqpugslvg,1748513120984000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,b3fc08df-9c7e-4775-adea-2c26083448f1,rvbcezyxmlwpqpugslvg,1748513120892000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,3183277e-953b-4480-b3a5-5e2b35d4120a,rvbcezyxmlwpqpugslvg,1748513120892000
null,LOG,connection received: host=::1 port=30163,null,6fed0ee7-9e3b-4636-9b69-251518ca5e61,rvbcezyxmlwpqpugslvg,1748513120880000
null,LOG,connection received: host=::1 port=30163,null,e2fdff33-a17c-4814-a6c6-02f2b463af47,rvbcezyxmlwpqpugslvg,1748513120880000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,7701d387-810a-4795-8dd1-a39483d702a0,rvbcezyxmlwpqpugslvg,1748513107110000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,8fe6a91d-5e3e-426c-a2a4-11e4ab98cdec,rvbcezyxmlwpqpugslvg,1748513107038000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,783654f7-c81f-44dc-a8f5-ea2d82b6c7ed,rvbcezyxmlwpqpugslvg,1748513105466000
null,LOG,"connection authorized: user=authenticator database=postgres application_name=postgrest SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,990d21bf-e624-4071-b4e7-2298c47356db,rvbcezyxmlwpqpugslvg,1748513105378000
null,LOG,connection received: host=::1 port=7683,null,75d9a66f-d16e-41d0-938f-5d556cdbf57e,rvbcezyxmlwpqpugslvg,1748513105370000
null,LOG,connection authorized: user=supabase_admin database=postgres application_name=postgres_exporter,null,6cb0e004-d709-406b-b1dc-0371f99b6418,rvbcezyxmlwpqpugslvg,1748513068904000
null,LOG,connection received: host=::1 port=22105,null,222d3621-a6ad-4c6b-b67e-c15c5d9eb167,rvbcezyxmlwpqpugslvg,1748513068903000
null,LOG,"checkpoint complete: wrote 39 buffers (0.1%); 0 WAL file(s) added, 0 removed, 0 recycled; write=3.828 s, sync=0.004 s, total=3.848 s; sync files=24, longest=0.003 s, average=0.001 s; distance=222 kB, estimate=337 kB",null,212aca21-0ac1-4fd3-9b9e-5152328e7703,rvbcezyxmlwpqpugslvg,1748513033269000
null,LOG,checkpoint starting: time,null,17dab4f5-8acc-4aad-9801-bfc2b443549e,rvbcezyxmlwpqpugslvg,1748513029422000
null,LOG,connection authorized: user=supabase_admin database=postgres application_name=postgres_exporter,null,36328e74-6e6a-42c8-8ad6-ce65c1df4846,rvbcezyxmlwpqpugslvg,1748513016378000
null,LOG,connection received: host=127.0.0.1 port=54189,null,c0f451b0-bdb5-470f-aff8-2f30ae809ebc,rvbcezyxmlwpqpugslvg,1748513016377000
null,LOG,"connection authenticated: identity=""supabase_admin"" method=scram-sha-256 (/etc/postgresql/pg_hba.conf:94)",null,c1e01660-a39b-47b9-bd6f-4e838c3a1c62,rvbcezyxmlwpqpugslvg,1748513012153000
null,LOG,"connection authorized: user=supabase_admin database=postgres application_name=postgres-meta 0.0.0-automated SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,7d527a3d-6ba3-443a-ae26-fd7b981e7433,rvbcezyxmlwpqpugslvg,1748513012153000
null,LOG,connection received: host=2406:da18:96a:8200:6970:c10c:da2a:ab9a port=52682,null,198d36ba-79b8-43f4-8225-72c52dbe3441,rvbcezyxmlwpqpugslvg,1748513011829000
null,LOG,"connection authenticated: identity=""postgres"" method=scram-sha-256 (/etc/postgresql/pg_hba.conf:94)",null,c15a8c02-7fdf-434e-bf14-507695b3b7c2,rvbcezyxmlwpqpugslvg,1748513009738000
null,LOG,"connection authorized: user=postgres database=postgres application_name=postgres-meta 0.0.0-automated SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,4b236330-f160-45a1-be98-1a5eea4e4b8f,rvbcezyxmlwpqpugslvg,1748513009738000
null,LOG,connection received: host=2406:da18:96a:8200:3c16:7e20:125f:cc1c port=40370,null,1aceb2ba-17d4-4211-88a9-4cd19daaae08,rvbcezyxmlwpqpugslvg,1748513009409000
null,LOG,"statement: DROP TYPE IF EXISTS pg_temp.tabledefs CASCADE;CREATE TYPE pg_temp.tabledefs AS ENUM('PKEY_INTERNAL','PKEY_EXTERNAL','FKEYS_INTERNAL','FKEYS_EXTERNAL','COMMENTS','FKEYS_NONE','INCLUDE_TRIGGERS','NO_TRIGGERS');CREATE OR REPLACE FUNCTION pg_temp.pg_get_coldef(in_schema text,in_table text,in_column text,oldway boolean default False)RETURNS text LANGUAGE plpgsql VOLATILE AS $$ DECLARE v_coldef text;v_dt1 text;v_dt2 text;v_dt3 text;v_nullable boolean;v_position int;v_identity text;v_generated text;v_hasdflt boolean;v_dfltexpr text;BEGIN IF oldway THEN SELECT pg_catalog.format_type(a.atttypid,a.atttypmod)INTO v_coldef FROM pg_namespace n,pg_class c,pg_attribute a,pg_type t WHERE n.nspname=in_schema AND n.oid=c.relnamespace AND c.relname=in_table AND a.attname=in_column and a.attnum>0 AND a.attrelid=c.oid AND a.atttypid=t.oid ORDER BY a.attnum;ELSE SELECT CASE WHEN a.atttypid=ANY('{int,int8,int2}'::regtype[])AND EXISTS(SELECT FROM pg_attrdef ad WHERE ad.adrelid=a.attrelid AND ad.adnum=a.attnum AND pg_get_expr(ad.adbin,ad.adrelid)='nextval('''||(pg_get_serial_sequence(a.attrelid::regclass::text,a.attname))::regclass||'''::regclass)')THEN CASE a.atttypid WHEN'int'::regtype THEN'serial'WHEN'int8'::regtype THEN'bigserial'WHEN'int2'::regtype THEN'smallserial'END ELSE format_type(a.atttypid,a.atttypmod)END AS data_type INTO v_coldef FROM pg_namespace n,pg_class c,pg_attribute a,pg_type t WHERE n.nspname=in_schema AND n.oid=c.relnamespace AND c.relname=in_table AND a.attname=in_column and a.attnum>0 AND a.attrelid=c.oid AND a.atttypid=t.oid ORDER BY a.attnum;END IF;RETURN v_coldef;END;$$;DROP FUNCTION IF EXISTS pg_temp.pg_get_tabledef(character varying,character varying,boolean,tabledefs[]);CREATE OR REPLACE FUNCTION pg_temp.pg_get_tabledef(in_schema varchar,in_table varchar,_verbose boolean,VARIADIC arr pg_temp.tabledefs[]DEFAULT'{}'::pg_temp.tabledefs[])RETURNS text LANGUAGE plpgsql VOLATILE AS $$ DECLARE v_qualified text:='';v_table_ddl text;v_table_oid int;v_colrec record;v_constraintrec record;v_trigrec record;v_indexrec record;v_rec record;v_constraint_name text;v_constraint_def text;v_pkey_def text:='';v_fkey_def text:='';v_fkey_defs text:='';v_trigger text:='';v_partition_key text:='';v_partbound text;v_parent text;v_parent_schema text;v_persist text;v_temp text:='';v_temp2 text;v_relopts text;v_tablespace text;v_pgversion int;bSerial boolean;bPartition boolean;bInheritance boolean;bRelispartition boolean;constraintarr text[]:='{}';constraintelement text;bSkip boolean;bVerbose boolean:=False;v_cnt1 integer;v_cnt2 integer;search_path_old text:='';search_path_new text:='';v_partial boolean;v_pos integer;pkcnt int:=0;fkcnt int:=0;trigcnt int:=0;cmtcnt int:=0;pktype pg_temp.tabledefs:='PKEY_INTERNAL';fktype pg_temp.tabledefs:='FKEYS_INTERNAL';trigtype pg_temp.tabledefs:='NO_TRIGGERS';arglen integer;vargs text;avarg pg_temp.tabledefs;v_ret text;v_diag1 text;v_diag2 text;v_diag3 text;v_diag4 text;v_diag5 text;v_diag6 text;BEGIN SET client_min_messages='notice';IF _verbose THEN bVerbose=True;END IF;arglen:=array_length($4,1);IF arglen IS NULL THEN NULL;ELSE IF bVerbose THEN RAISE NOTICE'arguments=%',$4;END IF;FOREACH avarg IN ARRAY $4 LOOP IF bVerbose THEN RAISE NOTICE'arg=%',avarg;END IF;IF avarg='FKEYS_INTERNAL'OR avarg='FKEYS_EXTERNAL'OR avarg='FKEYS_NONE'THEN fkcnt=fkcnt+1;fktype=avarg;ELSEIF avarg='INCLUDE_TRIGGERS'OR avarg='NO_TRIGGERS'THEN trigcnt=trigcnt+1;trigtype=avarg;ELSEIF avarg='PKEY_EXTERNAL'THEN pkcnt=pkcnt+1;pktype=avarg;ELSEIF avarg='COMMENTS'THEN cmtcnt=cmtcnt+1;END IF;END LOOP;IF fkcnt>1 THEN RAISE WARNING'Only one foreign key option can be provided. You provided %',fkcnt;RETURN'';ELSEIF trigcnt>1 THEN RAISE WARNING'Only one trigger option can be provided. You provided %',trigcnt;RETURN'';ELSEIF pkcnt>1 THEN RAISE WARNING'Only one pkey option can be provided. You provided %',pkcnt;RETURN'';ELSEIF cmtcnt>1 THEN RAISE WARNING'Only one comments option can be provided. You provided %',cmtcnt;RETURN'';END IF;END IF;SELECT c.oid,(select setting from pg_settings where name='server_version_num')INTO v_table_oid,v_pgversion FROM pg_catalog.pg_class c LEFT JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace WHERE c.relkind in('r','p')AND c.relname=in_table AND n.nspname=in_schema;SELECT setting INTO search_path_old FROM pg_settings WHERE name='search_path';EXECUTE'SET search_path = ""public""';SELECT setting INTO search_path_new FROM pg_settings WHERE name='search_path';IF(v_table_oid IS NULL)THEN RAISE EXCEPTION'table does not exist';END IF;SELECT tablespace INTO v_temp FROM pg_tables WHERE schemaname=in_schema and tablename=in_table and tablespace IS NOT NULL;IF v_temp IS NULL THEN v_tablespace:='TABLESPACE pg_default';ELSE v_tablespace:='TABLESPACE '||v_temp;END IF;WITH relopts AS(SELECT unnest(c.reloptions)relopts FROM pg_class c,pg_namespace n WHERE n.nspname=in_schema and n.oid=c.relnamespace and c.relname=in_table)SELECT string_agg(r.relopts,', ')as relopts INTO v_temp from relopts r;IF v_temp IS NULL THEN v_relopts:='';ELSE v_relopts:=' WITH ('||v_temp||')';END IF;v_partbound:='';bPartition:=False;bInheritance:=False;IF v_pgversion<100000 THEN SELECT c2.relname parent,c2.relnamespace::regnamespace INTO v_parent,v_parent_schema from pg_class c1,pg_namespace n,pg_inherits i,pg_class c2 WHERE n.nspname=in_schema and n.oid=c1.relnamespace and c1.relname=in_table and c1.oid=i.inhrelid and i.inhparent=c2.oid and c1.relkind='r';IF(v_parent IS NOT NULL)THEN bPartition:=True;bInheritance:=True;END IF;ELSE SELECT c2.relname parent,c1.relispartition,pg_get_expr(c1.relpartbound,c1.oid,true),c2.relnamespace::regnamespace INTO v_parent,bRelispartition,v_partbound,v_parent_schema from pg_class c1,pg_namespace n,pg_inherits i,pg_class c2 WHERE n.nspname=in_schema and n.oid=c1.relnamespace and c1.relname=in_table and c1.oid=i.inhrelid and i.inhparent=c2.oid and c1.relkind='r';IF(v_parent IS NOT NULL)THEN bPartition:=True;IF bRelispartition THEN bInheritance:=False;ELSE bInheritance:=True;END IF;END IF;END IF;IF bPartition THEN SELECT count(*)INTO v_cnt1 FROM information_schema.tables t WHERE EXISTS(SELECT REGEXP_MATCHES(s.table_name,'([A-Z]+)','g')FROM information_schema.tables s WHERE t.table_schema=s.table_schema AND t.table_name=s.table_name AND t.table_schema=in_schema AND t.table_name=in_table AND t.table_type='BASE TABLE');SELECT COUNT(*)INTO v_cnt2 FROM pg_get_keywords()WHERE word=in_table AND catcode='R';IF bInheritance THEN IF v_cnt1>0 OR v_cnt2>0 THEN v_table_ddl:='CREATE TABLE '||in_schema||'.""'||in_table||'""( '||E'\n';ELSE v_table_ddl:='CREATE TABLE '||in_schema||'.'||in_table||'( '||E'\n';END IF;ELSE IF v_relopts<>''THEN IF v_cnt1>0 OR v_cnt2>0 THEN v_table_ddl:='CREATE TABLE '||in_schema||'.""'||in_table||'"" PARTITION OF '||in_schema||'.'||v_parent||' '||v_partbound||v_relopts||' '||v_tablespace||'; '||E'\n';ELSE v_table_ddl:='CREATE TABLE '||in_schema||'.'||in_table||' PARTITION OF '||in_schema||'.'||v_parent||' '||v_partbound||v_relopts||' '||v_tablespace||'; '||E'\n';END IF;ELSE IF v_cnt1>0 OR v_cnt2>0 THEN v_table_ddl:='CREATE TABLE '||in_schema||'.""'||in_table||'"" PARTITION OF '||in_schema||'.'||v_parent||' '||v_partbound||' '||v_tablespace||'; '||E'\n';ELSE v_table_ddl:='CREATE TABLE '||in_schema||'.'||in_table||' PARTITION OF '||in_schema||'.'||v_parent||' '||v_partbound||' '||v_tablespace||'; '||E'\n';END IF;END IF;END IF;END IF;IF bVerbose THEN RAISE NOTICE'(1)tabledef so far: %',v_table_ddl;END IF;IF NOT bPartition THEN select c.relpersistence into v_persist from pg_class c,pg_namespace n where n.nspname=in_schema and n.oid=c.relnamespace and c.relname=in_table and c.relkind='r';IF v_persist='u'THEN v_temp:='UNLOGGED';ELSIF v_persist='t'THEN v_temp:='TEMPORARY';ELSE v_temp:='';END IF;END IF;IF NOT bPartition THEN SELECT count(*)INTO v_cnt1 FROM information_schema.tables t WHERE EXISTS(SELECT REGEXP_MATCHES(s.table_name,'([A-Z]+)','g')FROM information_schema.tables s WHERE t.table_schema=s.table_schema AND t.table_name=s.table_name AND t.table_schema=in_schema AND t.table_name=in_table AND t.table_type='BASE TABLE');IF v_cnt1>0 THEN v_table_ddl:='CREATE '||v_temp||' TABLE '||in_schema||'.""'||in_table||'"" ('||E'\n';ELSE v_table_ddl:='CREATE '||v_temp||' TABLE '||in_schema||'.'||in_table||' ('||E'\n';END IF;END IF;IF NOT bPartition THEN FOR v_colrec IN SELECT c.column_name,c.data_type,c.udt_name,c.udt_schema,c.character_maximum_length,c.is_nullable,c.column_default,c.numeric_precision,c.numeric_scale,c.is_identity,c.identity_generation,c.is_generated,c.generation_expression FROM information_schema.columns c WHERE(table_schema,table_name)=(in_schema,in_table)ORDER BY ordinal_position LOOP IF bVerbose THEN RAISE NOTICE'(col loop) name=%  type=%  udt_name=%  default=%  is_generated=%  gen_expr=%',v_colrec.column_name,v_colrec.data_type,v_colrec.udt_name,v_colrec.column_default,v_colrec.is_generated,v_colrec.generation_expression;END IF;SELECT CASE WHEN pg_get_serial_sequence(quote_ident(in_schema)||'.'||quote_ident(in_table),v_colrec.column_name)IS NOT NULL THEN True ELSE False END into bSerial;IF bVerbose THEN SELECT pg_get_serial_sequence(quote_ident(in_schema)||'.'||quote_ident(in_table),v_colrec.column_name)into v_temp;IF v_temp IS NULL THEN v_temp='NA';END IF;SELECT pg_temp.pg_get_coldef(in_schema,in_table,v_colrec.column_name)INTO v_diag1;RAISE NOTICE'DEBUG table: %  Column: %  datatype: %  Serial=%  serialval=%  coldef=%',v_qualified,v_colrec.column_name,v_colrec.data_type,bSerial,v_temp,v_diag1;RAISE NOTICE'DEBUG tabledef: %',v_table_ddl;END IF;SELECT COUNT(*)INTO v_cnt1 FROM information_schema.columns t WHERE EXISTS(SELECT REGEXP_MATCHES(s.column_name,'([A-Z]+)','g')FROM information_schema.columns s WHERE t.table_schema=s.table_schema and t.table_name=s.table_name and t.column_name=s.column_name AND t.table_schema=quote_ident(in_schema)AND column_name=v_colrec.column_name);SELECT COUNT(*)INTO v_cnt2 FROM pg_get_keywords()WHERE word=v_colrec.column_name AND catcode='R';IF v_cnt1>0 OR v_cnt2>0 THEN v_table_ddl:=v_table_ddl||'  ""'||v_colrec.column_name||'"" ';ELSE v_table_ddl:=v_table_ddl||'  '||v_colrec.column_name||' ';END IF;IF v_colrec.is_generated='ALWAYS'and v_colrec.generation_expression IS NOT NULL THEN v_temp=v_colrec.data_type||' GENERATED ALWAYS AS ('||v_colrec.generation_expression||') STORED ';ELSEIF v_colrec.udt_name in('geometry','box2d','box2df','box3d','geography','geometry_dump','gidx','spheroid','valid_detail')THEN v_temp=v_colrec.udt_name;ELSEIF v_colrec.data_type='USER-DEFINED'THEN v_temp=v_colrec.udt_schema||'.'||v_colrec.udt_name;ELSEIF v_colrec.data_type='ARRAY'THEN v_temp=pg_temp.pg_get_coldef(in_schema,in_table,v_colrec.column_name);ELSEIF pg_get_serial_sequence(quote_ident(in_schema)||'.'||quote_ident(in_table),v_colrec.column_name)IS NOT NULL THEN v_temp=pg_temp.pg_get_coldef(in_schema,in_table,v_colrec.column_name);ELSE v_temp=v_colrec.data_type;END IF;IF v_colrec.is_identity='YES'THEN IF v_colrec.identity_generation='ALWAYS'THEN v_temp=v_temp||' GENERATED ALWAYS AS IDENTITY';ELSE v_temp=v_temp||' GENERATED BY DEFAULT AS IDENTITY';END IF;ELSEIF v_colrec.character_maximum_length IS NOT NULL THEN v_temp=v_temp||('('||v_colrec.character_maximum_length||')');ELSEIF v_colrec.numeric_precision>0 AND v_colrec.numeric_scale>0 THEN v_temp=v_temp||'('||v_colrec.numeric_precision||','||v_colrec.numeric_scale||')';END IF;IF bSerial THEN v_temp=v_temp||' NOT NULL';ELSEIF v_colrec.is_nullable='NO'THEN v_temp=v_temp||' NOT NULL';ELSEIF v_colrec.is_nullable='YES'THEN v_temp=v_temp||' NULL';END IF;IF v_colrec.column_default IS NOT null AND NOT bSerial THEN v_temp=v_temp||(' DEFAULT '||v_colrec.column_default);END IF;v_temp=v_temp||','||E'\n';v_table_ddl:=v_table_ddl||v_temp;END LOOP;END IF;IF bVerbose THEN RAISE NOTICE'(2)tabledef so far: %',v_table_ddl;END IF;IF v_pgversion<110000 THEN FOR v_constraintrec IN SELECT con.conname as constraint_name,con.contype as constraint_type,CASE WHEN con.contype='p'THEN 1 WHEN con.contype='u'THEN 2 WHEN con.contype='f'THEN 3 WHEN con.contype='c'THEN 4 ELSE 5 END as type_rank,pg_get_constraintdef(con.oid)as constraint_definition FROM pg_catalog.pg_constraint con JOIN pg_catalog.pg_class rel ON rel.oid=con.conrelid JOIN pg_catalog.pg_namespace nsp ON nsp.oid=connamespace WHERE nsp.nspname=in_schema AND rel.relname=in_table ORDER BY type_rank LOOP v_constraint_name:=v_constraintrec.constraint_name;v_constraint_def:=v_constraintrec.constraint_definition;IF v_constraintrec.type_rank=1 THEN IF pkcnt=0 OR pktype='PKEY_INTERNAL'THEN v_constraint_name:=v_constraintrec.constraint_name;v_constraint_def:=v_constraintrec.constraint_definition;v_table_ddl:=v_table_ddl||'  '||'CONSTRAINT'||' '||v_constraint_name||' '||v_constraint_def||','||E'\n';ELSE SELECT'ALTER TABLE ONLY '||in_schema||'.'||c.relname||' ADD CONSTRAINT '||r.conname||' '||pg_catalog.pg_get_constraintdef(r.oid,true)||';'INTO v_pkey_def FROM pg_catalog.pg_constraint r,pg_class c,pg_namespace n where r.conrelid=c.oid and r.contype='p'and n.oid=r.connamespace and n.nspname=in_schema AND c.relname=in_table and r.conname=v_constraint_name;END IF;IF bPartition THEN continue;END IF;ELSIF v_constraintrec.type_rank=3 THEN IF fktype='FKEYS_NONE'THEN continue;ELSIF fkcnt=0 OR fktype='FKEYS_INTERNAL'THEN v_table_ddl:=v_table_ddl||'  '||'CONSTRAINT'||' '||v_constraint_name||' '||v_constraint_def||','||E'\n';ELSE SELECT'ALTER TABLE ONLY '||n.nspname||'.'||c2.relname||' ADD CONSTRAINT '||r.conname||' '||pg_catalog.pg_get_constraintdef(r.oid,true)||';'INTO v_fkey_def FROM pg_constraint r,pg_class c1,pg_namespace n,pg_class c2 where r.conrelid=c1.oid and r.contype='f'and n.nspname=in_schema and n.oid=r.connamespace and r.conrelid=c2.oid and c2.relname=in_table;v_fkey_defs=v_fkey_defs||v_fkey_def||E'\n';END IF;ELSE v_table_ddl:=v_table_ddl||'  '||'CONSTRAINT'||' '||v_constraint_name||' '||v_constraint_def||','||E'\n';END IF;if bVerbose THEN RAISE NOTICE'DEBUG4: constraint name=% constraint_def=%',v_constraint_name,v_constraint_def;END IF;constraintarr:=constraintarr||v_constraintrec.constraint_name::text;END LOOP;ELSE FOR v_constraintrec IN SELECT con.conname as constraint_name,con.contype as constraint_type,CASE WHEN con.contype='p'THEN 1 WHEN con.contype='u'THEN 2 WHEN con.contype='f'THEN 3 WHEN con.contype='c'THEN 4 ELSE 5 END as type_rank,pg_get_constraintdef(con.oid)as constraint_definition FROM pg_catalog.pg_constraint con JOIN pg_catalog.pg_class rel ON rel.oid=con.conrelid JOIN pg_catalog.pg_namespace nsp ON nsp.oid=connamespace WHERE nsp.nspname=in_schema AND rel.relname=in_table AND con.conparentid=0 ORDER BY type_rank LOOP v_constraint_name:=v_constraintrec.constraint_name;v_constraint_def:=v_constraintrec.constraint_definition;IF v_constraintrec.type_rank=1 THEN IF pkcnt=0 OR pktype='PKEY_INTERNAL'THEN v_constraint_name:=v_constraintrec.constraint_name;v_constraint_def:=v_constraintrec.constraint_definition;v_table_ddl:=v_table_ddl||'  '||'CONSTRAINT'||' '||v_constraint_name||' '||v_constraint_def||','||E'\n';ELSE SELECT'ALTER TABLE ONLY '||in_schema||'.'||c.relname||' ADD CONSTRAINT '||r.conname||' '||pg_catalog.pg_get_constraintdef(r.oid,true)||';'INTO v_pkey_def FROM pg_catalog.pg_constraint r,pg_class c,pg_namespace n where r.conrelid=c.oid and r.contype='p'and n.oid=r.connamespace and n.nspname=in_schema AND c.relname=in_table;END IF;IF bPartition THEN continue;END IF;ELSIF v_constraintrec.type_rank=3 THEN IF fktype='FKEYS_NONE'THEN continue;ELSIF fkcnt=0 OR fktype='FKEYS_INTERNAL'THEN v_table_ddl:=v_table_ddl||'  '||'CONSTRAINT'||' '||v_constraint_name||' '||v_constraint_def||','||E'\n';ELSE SELECT'ALTER TABLE ONLY '||n.nspname||'.'||c2.relname||' ADD CONSTRAINT '||r.conname||' '||pg_catalog.pg_get_constraintdef(r.oid,true)||';'INTO v_fkey_def FROM pg_constraint r,pg_class c1,pg_namespace n,pg_class c2 where r.conrelid=c1.oid and r.contype='f'and n.nspname=in_schema and n.oid=r.connamespace and r.conrelid=c2.oid and c2.relname=in_table and r.conname=v_constraint_name and r.conparentid=0;v_fkey_defs=v_fkey_defs||v_fkey_def||E'\n';END IF;ELSE v_table_ddl:=v_table_ddl||'  '||'CONSTRAINT'||' '||v_constraint_name||' '||v_constraint_def||','||E'\n';END IF;if bVerbose THEN RAISE NOTICE'DEBUG4: constraint name=% constraint_def=%',v_constraint_name,v_constraint_def;END IF;constraintarr:=constraintarr||v_constraintrec.constraint_name::text;END LOOP;END IF;select substring(v_table_ddl,length(v_table_ddl)-1,1)INTO v_temp;IF v_temp=','THEN v_table_ddl=substr(v_table_ddl,0,length(v_table_ddl)-1)||E'\n';END IF;IF bVerbose THEN RAISE NOTICE'(3)tabledef so far: %',trim(v_table_ddl);END IF;IF bVerbose THEN RAISE NOTICE'(4)tabledef so far: %',v_table_ddl;END IF;IF bPartition and bInheritance THEN IF v_parent_schema=''OR v_parent_schema IS NULL THEN v_parent_schema=in_schema;END IF;v_table_ddl:=v_table_ddl||') INHERITS ('||v_parent_schema||'.'||v_parent||') '||E'\n'||v_relopts||' '||v_tablespace||';'||E'\n';END IF;IF v_pgversion>=100000 AND NOT bPartition and NOT bInheritance THEN SELECT pg_get_partkeydef(c1.oid)as partition_key INTO v_partition_key FROM pg_class c1 JOIN pg_namespace n ON(n.oid=c1.relnamespace)LEFT JOIN pg_partitioned_table p ON(c1.oid=p.partrelid)WHERE n.nspname=in_schema and n.oid=c1.relnamespace and c1.relname=in_table and c1.relkind='p';IF v_partition_key IS NOT NULL AND v_partition_key<>''THEN v_table_ddl:=v_table_ddl||') PARTITION BY '||v_partition_key||';'||E'\n';ELSEIF v_relopts<>''THEN v_table_ddl:=v_table_ddl||') '||v_relopts||' '||v_tablespace||';'||E'\n';ELSE v_table_ddl:=v_table_ddl||') '||v_tablespace||';'||E'\n';END IF;END IF;IF bVerbose THEN RAISE NOTICE'(5)tabledef so far: %',v_table_ddl;END IF;IF v_pkey_def<>''THEN v_table_ddl:=v_table_ddl||v_pkey_def||E'\n';END IF;IF v_fkey_defs<>''THEN v_table_ddl:=v_table_ddl||v_fkey_defs||E'\n';END IF;IF bVerbose THEN RAISE NOTICE'(6)tabledef so far: %',v_table_ddl;END IF;FOR v_indexrec IN SELECT indexdef,COALESCE(tablespace,'pg_default')as tablespace,indexname FROM pg_indexes WHERE(schemaname,tablename)=(in_schema,in_table)LOOP bSkip=False;FOREACH constraintelement IN ARRAY constraintarr LOOP IF constraintelement=v_indexrec.indexname THEN bSkip=True;EXIT;END IF;END LOOP;if bSkip THEN CONTINUE;END IF;v_indexrec.indexdef:=REPLACE(v_indexrec.indexdef,'CREATE INDEX','CREATE INDEX IF NOT EXISTS');v_indexrec.indexdef:=REPLACE(v_indexrec.indexdef,'CREATE UNIQUE INDEX','CREATE UNIQUE INDEX IF NOT EXISTS');IF v_partition_key IS NOT NULL AND v_partition_key<>''THEN v_table_ddl:=v_table_ddl||v_indexrec.indexdef||';'||E'\n';ELSE select CASE WHEN i.indpred IS NOT NULL THEN True ELSE False END INTO v_partial FROM pg_index i JOIN pg_class c1 ON(i.indexrelid=c1.oid)JOIN pg_class c2 ON(i.indrelid=c2.oid)WHERE c1.relnamespace::regnamespace::text=in_schema AND c2.relnamespace::regnamespace::text=in_schema AND c2.relname=in_table AND c1.relname=v_indexrec.indexname;IF v_partial THEN v_temp=v_indexrec.indexdef;v_pos=POSITION(' WHERE 'IN v_temp);v_temp2=SUBSTRING(v_temp,v_pos);v_temp=SUBSTRING(v_temp,1,v_pos);v_table_ddl:=v_table_ddl||v_temp||' TABLESPACE '||v_indexrec.tablespace||v_temp2||';'||E'\n';ELSE v_table_ddl:=v_table_ddl||v_indexrec.indexdef||' TABLESPACE '||v_indexrec.tablespace||';'||E'\n';END IF;END IF;END LOOP;IF bVerbose THEN RAISE NOTICE'(7)tabledef so far: %',v_table_ddl;END IF;IF cmtcnt>0 THEN FOR v_rec IN SELECT c.relname,'COMMENT ON '||CASE WHEN c.relkind in('r','p')AND a.attname IS NULL THEN'TABLE 'WHEN c.relkind in('r','p')AND a.attname IS NOT NULL THEN'COLUMN 'WHEN c.relkind='f'THEN'FOREIGN TABLE 'WHEN c.relkind='m'THEN'MATERIALIZED VIEW 'WHEN c.relkind='v'THEN'VIEW 'WHEN c.relkind='i'THEN'INDEX 'WHEN c.relkind='S'THEN'SEQUENCE 'ELSE'XX'END||n.nspname||'.'||CASE WHEN c.relkind in('r','p')AND a.attname IS NOT NULL THEN quote_ident(c.relname)||'.'||a.attname ELSE quote_ident(c.relname)END||' IS '||quote_literal(d.description)||';'as ddl FROM pg_class c JOIN pg_namespace n ON(n.oid=c.relnamespace)LEFT JOIN pg_description d ON(c.oid=d.objoid)LEFT JOIN pg_attribute a ON(c.oid=a.attrelid AND a.attnum>0 and a.attnum=d.objsubid)WHERE d.description IS NOT NULL AND n.nspname=in_schema AND c.relname=in_table ORDER BY 2 desc,ddl LOOP v_table_ddl=v_table_ddl||v_rec.ddl||E'\n';END LOOP;END IF;IF bVerbose THEN RAISE NOTICE'(8)tabledef so far: %',v_table_ddl;END IF;IF trigtype='INCLUDE_TRIGGERS'THEN FOR v_trigrec IN select pg_get_triggerdef(t.oid,True)||';'as triggerdef FROM pg_trigger t,pg_class c,pg_namespace n WHERE n.nspname=in_schema and n.oid=c.relnamespace and c.relname=in_table and c.relkind='r'and t.tgrelid=c.oid and NOT t.tgisinternal LOOP v_table_ddl:=v_table_ddl||v_trigrec.triggerdef;v_table_ddl:=v_table_ddl||E'\n';IF bVerbose THEN RAISE NOTICE'triggerdef = %',v_trigrec.triggerdef;END IF;END LOOP;END IF;IF bVerbose THEN RAISE NOTICE'(9)tabledef so far: %',v_table_ddl;END IF;v_table_ddl:=v_table_ddl||E'\n';IF bVerbose THEN RAISE NOTICE'(10)tabledef so far: %',v_table_ddl;END IF;IF search_path_old=''THEN SELECT set_config('search_path','',false)into v_temp;ELSE EXECUTE'SET search_path = '||search_path_old;END IF;RETURN v_table_ddl;EXCEPTION WHEN others THEN BEGIN GET STACKED DIAGNOSTICS v_diag1=MESSAGE_TEXT,v_diag2=PG_EXCEPTION_DETAIL,v_diag3=PG_EXCEPTION_HINT,v_diag4=RETURNED_SQLSTATE,v_diag5=PG_CONTEXT,v_diag6=PG_EXCEPTION_CONTEXT;v_ret:='line='||v_diag6||'. '||v_diag4||'. '||v_diag1;RAISE EXCEPTION'%',v_ret;RETURN'';END;END;$$;

with records as (
  select
    c.oid::int8 as ""id"",
    case c.relkind
      when 'r' then pg_temp.pg_get_tabledef(
        concat(nc.nspname),
        concat(c.relname),
        false,
        'FKEYS_INTERNAL',
        'NO_TRIGGERS'
      )
      when 'v' then concat(
        'create view ', concat(nc.nspname, '.', c.relname), ' as',
        pg_get_viewdef(concat(nc.nspname, '.', c.relname), true)
      )
      when 'm' then concat(
        'create materialized view ', concat(nc.nspname, '.', c.relname), ' as',
        pg_get_viewdef(concat(nc.nspname, '.', c.relname), true)
      )
      when 'f' then concat('create foreign table ', nc.nspname, '.', c.relname, ' ( ... )')
      when 'p' then pg_temp.pg_get_tabledef(
        concat(nc.nspname),
        concat(c.relname),
        false,
        'FKEYS_INTERNAL',
        'NO_TRIGGERS'
      )
    end as ""sql""
  from
    pg_namespace nc
    join pg_class c on nc.oid = c.relnamespace
  where
    c.relkind in ('r', 'v', 'm', 'f', 'p')
    and not pg_is_other_temp_schema(nc.oid)
    and (
      pg_has_role(c.relowner, 'USAGE')
      or has_table_privilege(
        c.oid,
        'SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER'
      )
      or has_any_column_privilege(c.oid, 'SELECT, INSERT, UPDATE, REFERENCES')
    )
    and nc.nspname IN ('public')
  order by c.relname asc
  limit 100
  offset 0
)
select
  jsonb_build_object(
    'definitions', coalesce(jsonb_agg(
      jsonb_build_object(
        'id', r.id,
        'sql', r.sql
      )
    ), '[]'::jsonb)
  ) ""data""
from records r;

-- source: dashboard
-- user: ef90450b-126d-4a72-841c-9c0f11f3396f
-- date: 2025-05-29T10:02:57.055Z",null,6f999df5-d14b-4b3e-8d3a-624d1921f7a0,rvbcezyxmlwpqpugslvg,1748512980738000
null,LOG,"connection authenticated: identity=""postgres"" method=scram-sha-256 (/etc/postgresql/pg_hba.conf:94)",null,f5b68e2a-c8fd-4001-876c-9181d8779741,rvbcezyxmlwpqpugslvg,1748512980490000
null,LOG,"connection authorized: user=postgres database=postgres application_name=postgres-meta 0.0.0-automated SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,86d10fc3-83b9-4cb7-bada-c27019facec1,rvbcezyxmlwpqpugslvg,1748512980490000
null,LOG,connection received: host=2406:da18:96a:8201:410c:8512:dc0c:f2e9 port=53572,null,560e423d-6488-4e18-adc0-6090cd085a2f,rvbcezyxmlwpqpugslvg,1748512980171000
null,LOG,"connection authorized: user=postgres database=postgres application_name=postgres-meta 0.0.0-automated SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,892f8912-2976-427b-bd91-0a39bc9d3a42,rvbcezyxmlwpqpugslvg,1748512975315000
null,LOG,"connection authenticated: identity=""postgres"" method=scram-sha-256 (/etc/postgresql/pg_hba.conf:94)",null,e2047cc8-8146-4a33-8827-470d1072dbb8,rvbcezyxmlwpqpugslvg,1748512975315000
null,LOG,"connection authenticated: identity=""supabase_admin"" method=scram-sha-256 (/etc/postgresql/pg_hba.conf:94)",null,ef4e9a92-a9b8-4135-9837-a3212a97536f,rvbcezyxmlwpqpugslvg,1748512973264000
null,LOG,"connection authorized: user=supabase_admin database=postgres application_name=postgres-meta 0.0.0-automated SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,608aa040-f489-4759-80f2-d35870ee31d3,rvbcezyxmlwpqpugslvg,1748512973264000
null,LOG,"connection authorized: user=postgres database=postgres application_name=postgres-meta 0.0.0-automated SSL enabled (protocol=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384, bits=256)",null,8650948f-c33b-4fd8-9b83-bb89f73cb6af,rvbcezyxmlwpqpugslvg,1748512972091000